title: POJ 3468 A Simple Problem with Integers（线段树）
date: 2014-10-29 23:56
tags: [数据结构, 线段树]
categories: [ACM]
toc: true
---
# 题目	
源地址：http://poj.org/problem?id=3468

# 题意
给出一个有$n$个元素的数组，元素一开始有初值。
现在有$q$次操作，每次操作有两个选择：
“C a b c”：将[a, b]的所有元素加上c
“Q a b”：查询[a, b]所有元素的和
数据范围：$1{\leq}N,Q{\leq}1e5$, $-1e9{\leq}a_i{\leq}1e9$, $-1e4{\leq}c{\leq}1e4$

# 思路
线段树成段更新，update：成段增减	query：区间求和
<!--more-->

# 代码
```
#include<iostream>
#include<cstdio>
#include<cstring>
#include<algorithm>
using namespace std;
#define ll long long
#define lson l, m, rt << 1
#define rson m + 1, r, rt << 1 | 1
const int maxn = 111111;
ll sum[maxn << 2], add[maxn << 2];
void pushup(int rt) {
    sum[rt] = sum[rt << 1] + sum[rt << 1 | 1];
}
void build(int l, int r, int rt) {
    add[rt] = 0;
    if (l == r) {
        scanf("%lld", &sum[rt]);
        return ;
    }
    int m = (l + r) >> 1;
    build(lson);
    build(rson);
    pushup(rt);
}
void pushdown(int rt, int m) {
    if (add[rt]) {
        add[rt << 1] += add[rt];
        add[rt << 1 | 1] += add[rt];
        sum[rt << 1] += (m - (m >> 1)) * add[rt];
        sum[rt << 1 | 1] += (m >> 1) * add[rt];
        add[rt] = 0;
    }
}
void update(int L, int R, int c, int l, int r, int rt) {
    if (L <= l && r <= R) {
        add[rt] += c;
        sum[rt] += c * (r - l + 1);
        return ;
    }
    pushdown(rt, r - l + 1);
    int m = (l + r) >> 1;
    if (L <= m) update(L, R, c, lson);
    if (R > m) update(L, R, c, rson);
    pushup(rt);
}
ll query(int L, int R, int l, int r, int rt) {
    if (L <= l && r <= R) return sum[rt];
    pushdown(rt, r - l + 1);
    int m = (l + r) >> 1;
    ll ret = 0;
    if (L <= m) ret += query(L, R, lson);
    if (R > m) ret += query(L, R, rson);
    return ret;
}
int main () {
    int n, q;
    char ch[10];
    int l, r, c;
    scanf("%d%d", &n, &q);
    build(1, n, 1);
    while(q--) {
        scanf("%s", ch);
        scanf("%d%d", &l, &r);
        if (ch[0] == 'Q') printf("%lld\n", query(l, r, 1, n, 1));
        else {
            scanf("%d", &c);
            update(l, r, c, 1, n, 1);
        }
    }
    return 0;
}
```

# 更新日志
- 13579810	SIO__Five	3468	Accepted	4776K	2579MS	G++	1770B	2014-10-29 23:52:08
